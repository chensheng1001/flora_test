## Flora Test

#### 结果对比

1. 无梯度累积 (batch size 64)，需要测r不同下flora和lora

|    优化器     | 使用LoRA | 最大显存 (MB) | 缓存 (MB) | 困惑度  |
| :-----------: | :------: | :-----------: | :-------: | :-----: |
|     adamw     |    否    |     53934     |   58356   | 23.1426 |
|     adamw     |   r=8    |     47384     |   54060   | 25.2553 |
|   adafactor   |    否    |     52986     |   58356   | 23.3787 |
|   adafactor   |   r=8    |     47382     |   54058   | 29.3655 |
|   adafactor   |   r=32   |     47422     |   54052   | 29.3661 |
|   adafactor   |  r=128   |     47588     |   54052   | 29.3659 |
|   adafactor   |  r=256   |     47788     |   48516   | 29.3659 |
|  flora (r=8)  |    /     |     52986     |   58356   | 23.3787 |
| flora (r=32)  |    /     |     52986     |   58356   | 23.3787 |
| flora (r=128) |    /     |     52986     |   58356   | 23.3787 |
| flora (r=256) |    /     |     52986     |   58356   | 23.3787 |

2. 梯度累积，确定一种优化器 (adafactor)，需要测r不同下flora和lora (batch size=16, gradient_accumulation_step=4 )

|           方法           | 最大显存 | 缓存  | 困惑度  |
| :----------------------: | :------: | :---: | :-----: |
| 原始梯度累积 (adafactor) |  15189   | 20672 | 23.2794 |
|        LoRA (r=8)        |  13767   | 18846 | 29.3238 |
|          FLoRA           |  15189   | 20672 | 23.2795 |



